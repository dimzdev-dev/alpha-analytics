<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Alpha-Analytics · Dashboard Trading Local</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#020617">


</head>

<body>
    <!-- Loading screen -->
    <div id="loading-overlay">
        <div class="loading-box">
            <div class="loading-box-title">
                <img src="img/logo.png" alt="Alpha Analytics" class="logo-loading" />
            </div>

            <div class="spinner"></div>
            <p class="loading-text">Chargement du dashboard...</p>
        </div>
    </div>

    <div class="app">
        <header>
            <div class="header-left">
                <img src="img/logo.png" alt="Alpha Analytics" class="logo-img" />
                <div class="header-brand-text">


                </div>
            </div>


            <nav class="header-nav">
                <button class="nav-btn active" data-target="section-dashboard">
                    <span class="icon"><i class="fa-solid fa-chart-line"></i></span> Dashboard
                </button>
                <button class="nav-btn" data-target="section-historique">
                    <span class="icon"><i class="fa-solid fa-list-ul"></i></span> Historique
                </button>
                <button class="nav-btn" data-target="section-parametres">
                    <span class="icon"><i class="fa-solid fa-gear"></i></span> Paramètres
                </button>
            </nav>

            <div class="header-right">
    <button id="btn-install-pwa-header" class="btn btn-outline" style="display:none;">
        <i class="fa-solid fa-desktop"></i> Installer l'app
    </button>
</div>

        </header>

        <div class="layout">
            <main class="content">
                <!-- Dashboard -->
                <section id="section-dashboard" class="section active">
                    <div class="flex-between">
                        <div>
                            <h2>Dashboard</h2>
                            <p class="section-subtitle">
                                Vue d’ensemble de tes performances, calculée à partir des trades importés et filtrés.
                            </p>
                            <p class="text-muted mt-1">
                                Compte :
                                <span id="account-name-display">Non défini</span>
                                ·
                                <span id="account-type-display">MT4 / MT5</span>
                            </p>
                        </div>
                        <div class="flex">
    <button id="btn-reset-data-dashboard" class="btn btn-outline" title="Réinitialiser toutes les données">
        <i class="fa-solid fa-rotate-right"></i>
    </button>

    <button id="btn-toggle-filters" class="btn btn-outline">
        <i class="fa-solid fa-sliders"></i> Filtres
    </button>

    <button id="open-import-modal-btn" class="btn btn-primary">
        <i class="fa-solid fa-plus"></i> Importer
    </button>
</div>

                    </div>

                    <!-- Filtres - menu déroulant -->
                    <div class="card-soft mt-3 filters-panel collapsed" id="filters-panel">
                        <div class="filters-bar">
                            <div class="filter-group">
                                <label for="filter-date-from">Date début</label>
                                <input type="date" id="filter-date-from" />
                            </div>
                            <div class="filter-group">
                                <label for="filter-date-to">Date fin</label>
                                <input type="date" id="filter-date-to" />
                            </div>
                            <div class="filter-group">
                                <label for="filter-symbol">Symbole</label>
                                <select id="filter-symbol">
                                    <option value="ALL">Tous</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filter-direction">Direction</label>
                                <select id="filter-direction">
                                    <option value="ALL">Toutes</option>
                                    <option value="long">Long</option>
                                    <option value="short">Short</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filter-result">Résultat</label>
                                <select id="filter-result">
                                    <option value="ALL">Tous</option>
                                    <option value="WIN">Gagnants</option>
                                    <option value="LOSS">Perdants</option>
                                </select>
                            </div>
                            <div class="filter-group" style="min-width:auto;">
                                <button id="btn-reset-filters" class="btn btn-outline">
                                    <i class="fa-solid fa-rotate-left"></i> Réinitialiser
                                </button>
                            </div>
                        </div>
                        <p class="text-muted mt-1" id="filters-summary"></p>
                    </div>

                    <!-- Stats principales -->
                    <div class="grid grid-3 mt-4">
                        <div class="card-soft">
                            <div class="stat-label">Résultat net (filtré)</div>
                            <div class="stat-value" id="stat-pnl-total">–</div>
                            <div class="stat-chip" id="stat-pnl-chip">
                                <span>En attente de données</span>
                            </div>
                        </div>

                        <div class="card-soft">
                            <div class="stat-label">Taux de réussite</div>
                            <div class="stat-value" id="stat-winrate">–</div>
                            <p class="text-muted mt-2">
                                <span id="stat-trades-win">0</span> gagnants /
                                <span id="stat-trades-loss">0</span> perdants
                            </p>
                        </div>

                        <div class="card-soft">
                            <div class="stat-label">Nombre de trades</div>
                            <div class="stat-value" id="stat-trades-count">0</div>
                            <p class="text-muted mt-2">
                                <span id="stat-instruments-count">0</span> instruments différents
                            </p>
                        </div>
                    </div>

                    <!-- Stats avancées -->
                    <div class="card-soft mt-4">
                        <h3>Stats avancées</h3>
                        <div class="grid grid-3 mt-3">
                            <div>
                                <div class="stat-label">PnL moyen / trade</div>
                                <div class="stat-value" id="stat-avg-pnl">–</div>
                                <p class="text-muted mt-1">
                                    Gain moyen: <span id="stat-avg-win">–</span><br />
                                    Perte moyenne: <span id="stat-avg-loss">–</span>
                                </p>
                            </div>
                            <div>
                                <div class="stat-label">Profit factor</div>
                                <div class="stat-value" id="stat-profit-factor">–</div>
                                <p class="text-muted mt-1">
                                    Gains totaux: <span id="stat-gross-profit">–</span><br />
                                    Pertes totales: <span id="stat-gross-loss">–</span>
                                </p>
                            </div>
                            <div>
                                <div class="stat-label">Séries</div>
                                <div class="stat-value" id="stat-streaks">–</div>
                                <p class="text-muted mt-1">
                                    Plus longue série gagnante: <span id="stat-best-win-streak">0</span><br />
                                    Plus longue série perdante: <span id="stat-best-loss-streak">0</span>
                                </p>
                            </div>
                        </div>

                        <div class="flex-between mt-3">
                            <p class="text-muted">
                                Capital initial : <strong id="stat-starting-capital">–</strong>
                            </p>
                            <p class="text-muted">
                                Capital total fermé : <strong id="stat-closed-equity">–</strong>
                                · Max drawdown :
                                <strong id="stat-max-dd-abs">–</strong>
                                (<span id="stat-max-dd-pct">–</span>)
                            </p>
                        </div>
                    </div>

                    <!-- Best/worst trade -->
                    <div class="card-soft mt-4">
                        <div class="flex-between">
                            <div>
                                <div class="stat-label">Trade le plus performant</div>
                                <div class="stat-value text-success" id="stat-best-trade">–</div>
                            </div>
                            <div>
                                <div class="stat-label">Pire trade</div>
                                <div class="stat-value text-danger text-right" id="stat-worst-trade">–</div>
                            </div>
                        </div>
                        <p class="text-muted mt-3" id="stat-summary">
                            Importe un rapport MT4 pour voir un résumé détaillé de ta performance.
                        </p>
                    </div>

                    <!-- Graphs -->
                    <div class="grid grid-2 mt-4">
                        <div class="card-soft">
                            <h3>Évolution de l’equity</h3>
                            <canvas id="equityChart"></canvas>
                        </div>
                        <div class="card-soft">
                            <h3>PnL par instrument</h3>
                            <canvas id="pnlBySymbolChart"></canvas>
                        </div>
                    </div>

                    <div class="grid grid-2 mt-4">
                        <div class="card-soft">
                            <h3>PnL par jour de la semaine</h3>
                            <canvas id="pnlByWeekdayChart"></canvas>
                        </div>
                        <div class="card-soft">
                            <h3>PnL par heure d’ouverture</h3>
                            <canvas id="pnlByHourChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Historique -->
                <section id="section-historique" class="section">
                    <h2>Historique des trades</h2>
                    <p class="section-subtitle">
                        Tous les trades sont stockés dans ton navigateur après import de rapports MT4.
                    </p>

                    <div class="card-soft mt-1">
                        <div class="flex-between">
                            <h3>Liste des trades (après filtres)</h3>
                            <span class="text-muted">
                                Total : <span id="trades-count-table">0</span> trades
                            </span>
                        </div>

                        <table class="mt-2">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Symbole</th>
                                    <th>Dir.</th>
                                    <th>Taille</th>
                                    <th>Entrée</th>
                                    <th>Sortie</th>
                                    <th id="pnl-header-label">PnL (€)</th>
                                </tr>
                            </thead>
                            <tbody id="trades-tbody">
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Paramètres -->
                <section id="section-parametres" class="section">
                    <h2>Paramètres</h2>
                    <p class="section-subtitle">
                        Gestion des données locales de Alpha-Analytics.
                    </p>

                    <div class="card-soft">
                        <h3>Données locales</h3>
                        <p class="text-muted mt-2">
                            Toutes les données sont stockées dans <code>localStorage</code> :
                            <code>tradeAnalytics_trades</code> pour les trades, <code>tradeAnalytics_meta</code> pour
                            les infos de compte.
                        </p>

                        <div class="flex mt-3">
                            <button id="btn-reset-data" class="btn btn-outline btn-danger">
                                <i class="fa-solid fa-trash"></i> Réinitialiser toutes les données
                            </button>

                            <button id="btn-install-pwa" class="btn btn-outline" style="margin-left:0.75rem; display:none;">
                                <i class="fa-solid fa-desktop"></i> Créer un raccourci sur le bureau
                        </button>
                        </div>

                        <p class="text-muted mt-3">
                            Idées pour plus tard : multi-comptes, journal de trading, tags de stratégie, screenshots,
                            etc.
                        </p>
                    </div>
                </section>
            </main>
        </div>

        <footer>
            <div class="footer-inner">
                <span>Alpha-Analytics · App locale · v1.0.4</span>
                <span>Propulsé par dimzdev</span>
            </div>
        </footer>
    </div>

    <!-- MODAL IMPORT -->
    <div id="import-modal" class="modal-backdrop">
        <div class="modal-panel">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fa-solid fa-file-import"></i> Importer un rapport MT4
                </div>
                <button type="button" class="modal-close-btn import-modal-close">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <form id="import-form">
                <div>
                    <label for="account-name">Nom du compte</label>
                    <input id="account-name" type="text" maxlength="20" placeholder="Ex : FTMO 100k" />
                    <p class="text-muted mt-1">
                        20 caractères max. Exemple : "Vantage 10k", "FTMO 100k".
                    </p>
                </div>

                <div>
                    <label>Type de compte</label>
                    <div class="account-type-options">
                        <label class="account-type-option">
                            <input type="radio" name="account-type" value="MT4" checked />
                            MT4
                        </label>
                        <label class="account-type-option">
                            <input type="radio" name="account-type" value="MT5" />
                            MT5
                        </label>
                    </div>
                    <div>
                        <label>Devise d'affichage</label>
                        <div class="account-type-options">
                            <label class="account-type-option">
                                <input type="radio" name="account-currency" value="EUR" checked />
                                €
                            </label>
                            <label class="account-type-option">
                                <input type="radio" name="account-currency" value="USD" />
                                $
                            </label>
                        </div>
                    </div>

                </div>

                <div>
                    <label for="account-capital">Capital initial (€)</label>
                    <input id="account-capital" type="number" step="0.01" min="0" placeholder="Ex : 100000" />
                    <p class="text-muted mt-1">
                        Si vide, un capital par défaut sera utilisé (10&nbsp;000&nbsp;€).
                    </p>
                </div>

                <div>
                    <label for="import-file">Rapport MT4 (HTML)</label>
                    <input id="import-file" type="file" accept=".html,.htm" required />
                    <p class="text-muted mt-1">
                        Dans MT4 : <strong>Historique du compte</strong> &rarr; clic droit &rarr; <strong>Enregistrer en
                            tant que rapport</strong>.
                    </p>
                </div>

                <p class="text-muted mt-2" id="import-modal-status"></p>

                <div class="flex mt-3" style="justify-content: flex-end;">
                    <button type="button" class="btn btn-outline import-modal-close">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary" id="import-submit-btn">
                        <i class="fa-solid fa-file-arrow-up"></i> Importer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CONFIRM RESET -->
<!-- MODAL RESET DONNÉES -->
<div id="reset-modal" class="modal-backdrop">
    <div class="modal-panel">
        <div class="modal-header">
            <div class="modal-title">
                <i class="fa-solid fa-triangle-exclamation"></i>
                Réinitialiser les données ?
            </div>
            <button type="button" class="modal-close-btn reset-close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <p class="text-muted mt-1">
            Tu es sûr ? Cela va supprimer <strong>tous les trades</strong> et
            <strong>toutes les infos de compte</strong> stockés localement dans ton navigateur.
            Cette action est définitive.
        </p>

        <div class="flex mt-3" style="justify-content: flex-end;">
            <button type="button" class="btn btn-outline reset-close">
                Annuler
            </button>
            <button type="button" class="btn btn-primary btn-danger" id="reset-confirm">
                <i class="fa-solid fa-trash"></i> Oui, réinitialiser
            </button>
        </div>
    </div>
</div>


<!-- MODAL INSTALL APP -->
<div id="install-modal" class="modal-backdrop">
    <div class="modal-panel">
        <div class="modal-header">
            <div class="modal-title">
                <i class="fa-solid fa-desktop"></i> Installer Alpha-Analytics
            </div>
            <button type="button" class="modal-close-btn install-cancel">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <p class="text-muted mt-1">
            Alpha-Analytics va être installée comme une application sur ton ordinateur
            (icône sur le bureau / menu démarrer). Le navigateur affichera ensuite
            une petite fenêtre de confirmation.
        </p>

        <div class="install-progress mt-3">
            <div class="install-progress-bar" id="install-progress-bar"></div>
        </div>
        <p class="text-muted mt-1" id="install-progress-text">
            En attente de confirmation...
        </p>

        <div class="flex mt-3" style="justify-content: flex-end;">
            <button type="button" class="btn btn-outline install-cancel">
                Annuler
            </button>
            <button type="button" id="install-confirm" class="btn btn-primary">
                <i class="fa-solid fa-desktop"></i> Installer
            </button>
        </div>
    </div>
</div>

<!-- MODAL MISE À JOUR -->
<div id="update-modal" class="modal-backdrop">
  <div class="modal-panel">
    <div class="modal-header">
      <div class="modal-title">
        <i class="fa-solid fa-rotate"></i> Nouvelle version disponible
      </div>
      <button type="button" class="modal-close-btn" id="update-modal-close">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <p class="text-muted mt-2">
      Une nouvelle version d’Alpha-Analytics est disponible.
    </p>

    <p class="text-muted mt-2" id="update-modal-changelog"></p>

    <div class="flex mt-3" style="justify-content: flex-end;">
      <button type="button" class="btn btn-outline" id="update-remind-later">
        Plus tard
      </button>
      <button type="button" class="btn btn-primary" id="update-reload-now">
        <i class="fa-solid fa-rotate-right"></i> Mettre à jour
      </button>
    </div>
  </div>
</div>




    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- App logic -->
    <script src="app.js"></script>
</body>

</html>
